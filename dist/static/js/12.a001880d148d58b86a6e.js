webpackJsonp([12],{b2XM:function(t,e){},kluF:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("2Uyi"),a={data:function(){return{baseUrl:s.a.ossUrl,loaded:!1,percent:0,prizeList:[],rotateStyle:"",isShowPrize:!1,recordList:[],rotate:0,prize:{},prevprize:.5,rotating:!1}},created:function(){this.loadImage(),this.getPrizeRecord()},filters:{time2str:function(t){var e=1e3*Number(t),i=new Date(e),s=i.getFullYear(),a=i.getMonth()+1,r=i.getDate();return[s,a=a>9?a:"0"+a,r=r>9?r:"0"+r].join("/")}},methods:{loadImage:function(){var t=this,e=["../../static/images/lucky_bg.png","../../static/images/lucky_title.png","../../static/images/lucky_table.png","../../static/images/lucky_cursor.png"],i=0;e.forEach(function(s){var a=new Image;a.onload=function(){i++,t.percent=Number(i/e.length*100).toFixed(2),i==e.length&&t.getPrizeList()},a.src=s})},getPrizeList:function(){var t=this;this.$api.getPrizeList().then(function(e){1==e.code?(t.prizeList=e.data.list,t.loaded=!0):t.$popup(e.msg)})},getPrizeRecord:function(){var t=this;this.$api.getPrizeRecord({page:1,pagesize:100}).then(function(e){1==e.code&&(t.recordList=e.data.list)})},lottery:function(){var t=this;if(!this.rotating){var e=this.$store.state.userInfo;e.score<50?this.$popup("积分不足"):this.$dialog.confirm({title:"确认要抽奖吗",message:"抽奖需要消耗50积分，当前剩余积分"+e.score}).then(function(){t.rotating=!0,t.$api.toLottery().then(function(i){1==i.code?(t.prize=i.data.prize,e.score=i.data.score,t.$store.dispatch("updateUserInfo",e),t.effectLuckyDraw()):(t.rotating=!1,t.$popup(i.msg))})}).catch(function(){})}},effectLuckyDraw:function(){var t=this,e=0;this.prizeList.forEach(function(i,s){i.id==t.prize.id&&(e=s)});var i=-360*(6+parseInt(3*Math.random()))+60*(e-this.prevprize);this.rotate+=i,console.log(this.rotate,this.prize.id,e,this.prevprize),this.rotateStyle="transform:rotate("+-1*this.rotate+"deg)",this.prevprize=e,setTimeout(function(){t.rotating=!1,t.showPrize()},6300)},showPrize:function(){"谢谢惠顾"!=this.prize.name&&(this.isShowPrize=!0)},closeLayer:function(){this.isShowPrize=!1}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"lucky-wrap"},[i("div",{staticClass:"lucky",class:{animate:t.loaded},attrs:{id:"lucky"}},[i("div",{staticClass:"pannel-title"}),t._v(" "),i("div",{staticClass:"pannel-table"},[i("div",{staticClass:"table-bg",style:t.rotateStyle}),t._v(" "),i("div",{staticClass:"pointer-bg",on:{click:t.lottery}})]),t._v(" "),i("div",{staticClass:"tips"},[t._v("奖品线下领取，中奖后工作人员会联系您发放奖品")]),t._v(" "),t.recordList.length?i("div",{staticClass:"prize-record"},[i("label",[t._v("中奖记录")]),t._v(" "),i("ul",{staticClass:"prize-record-list"},[t._m(0),t._v(" "),t._l(t.recordList,function(e){return i("li",[i("span",[t._v(t._s(t._f("time2str")(e.createtime)))]),t._v(" "),i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",{class:["1"==e.is_received?"red":"green"]},[t._v(t._s("1"==e.is_received?"已领取":"未领取"))])])})],2)]):t._e()]),t._v(" "),t.isShowPrize?i("div",{staticClass:"layer-lucky-bg"}):t._e(),t._v(" "),t.isShowPrize?i("div",{staticClass:"layer-pk-mode success layer-lucky"},[i("div",{staticClass:"gameover-result-title"},[t._v("恭喜中奖")]),t._v(" "),i("div",{staticClass:"gameover-result-content"},[i("div",{staticClass:"prize"},[i("img",{attrs:{src:t.prize.small_image}})]),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"game-score-count"},[t._v(t._s(t.prize.name))]),t._v(" "),i("div",{staticClass:"gameover-btns"},[i("a",{staticClass:"try-again",on:{click:t.closeLayer}},[t._v("关闭")])])])]):t._e(),t._v(" "),t.loaded?t._e():i("div",{staticClass:"lucky-loading",attrs:{id:"lucky-loading"}},[i("span",[t._v("加载中 "+t._s(t.percent)+"%")])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticClass:"title"},[e("span",[this._v("日期")]),e("span",[this._v("奖品名称")]),e("span",[this._v("奖品状态")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{staticClass:"game-this-round"},[e("em",[this._v("中奖获得")])])}]};var n=i("VU/8")(a,r,!1,function(t){i("b2XM")},null,null);e.default=n.exports}});
//# sourceMappingURL=12.a001880d148d58b86a6e.js.map