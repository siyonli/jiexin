webpackJsonp([5],{"3WYo":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABLCAMAAADH/GAOAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAzUExURUdwTIKCgnx8fHx8fH9/f3p6ent7e319fXt7e3t7e3x8fHt7e3t7e3p6ent7e3p6ent7e8tB68gAAAAQdFJOUwAWdy0G/YZJ0fjBXKnpPppKPzSZAAABiUlEQVR42u3ZUY7rIAyF4QMYYgNJ2P9qrzSqZlqSIZSah6vJt4BfJlJ4wABZlqJM2BJAsUwRCbZMYsFlEoaUSQRlmjt9p/9SWrJNyWZRT0sw+GKC6KbXDd+2VTHtxeGJE8WpE14kvTTjFbFa2qJi1dIOFaeWNqgYtTShQv/D1AmVpJbOqGS1tHd44bxaukTCE4pFL+0zNT+HlxxClJF08dHgwRxnFktd9y3KKdk3AmjbpVT86vDguDtdN1Zfjtjgm+F2uq19lxvWS9f/k1nV0jsqm1dKM6FmldILjlglnXHC+XfT0aYUXidaDc6E99Ls8GV5jiecIn4nnQkPtP+cA+covZGOZ+cVh99wd3o1OGkH/GrpTfsNOLYjGmJf2mfUrC9s0LB1ph0OXCI0xZ60zzgiXFi6pnYYwR1pxpDUkbYYw9dpgyGULtOMQbRepQNGhav0hlHGt9OeMCy304xxSzu94wPcTFt8IDTTYV5awjIsyP2Kc6fv9AdmvrpzmYQnbjgm7mUmbpP+Ad1tRjvfmJoDAAAAAElFTkSuQmCC"},Eg0l:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("2Uyi"),a={data:function(){return{baseUrl:s.a.ossUrl,id:this.$route.query.id,title:"",message:"",pushing:!1,imageFiles:[],imageSrc:[],images:[],btnText:"发布"}},created:function(){this.id&&this.getArticleDetail(this.id)},methods:{getArticleDetail:function(e){var t=this;this.$api.getCaseDetail({id:e}).then(function(e){if(1==e.code){var i=e.data.item;t.title=i.title,t.message=i.content,t.imageSrc=i.images,t.images=i.images,t.imageFiles=i.images.map(function(e){return e})}else t.$popup(e.msg)})},openFileSelect:function(){this.imageFiles.length>=6||document.getElementById("files").click()},fileChange:function(){var e=this,t=document.getElementById("files"),i=Array.prototype.slice.call(t.files),s=6-this.imageFiles.length,a=i.slice(0,s),n=new Array(a.length);this.imageSrc=this.imageSrc.concat(n),this.imageFiles=this.imageFiles.concat(a),this.imageFiles.forEach(function(t,i){if("string"!=typeof t){var s=new FileReader;s.readAsDataURL(t),s.onload=function(){e.imageSrc[i]=s.result,e.$forceUpdate()}}})},removeImage:function(e){this.imageSrc.splice(e,1),this.imageFiles.splice(e,1),this.images.splice(e,1),this.$forceUpdate()},publick:function(){this.pushing||(this.title?this.message?(this.pushing=!0,this.btnText="正在上传图片...",this.uploadFiles()):this.$popup("请输入正文"):this.$popup("请输入标题"))},uploadFiles:function(){var e=this,t=new FormData,i=this.imageFiles.filter(function(e){return"string"==typeof e}).length,s=this.imageFiles.length-i;console.log(i,s);var a=0;!s&&this.id&&this.submitForm(),this.imageFiles.length||this.id||this.submitForm(),this.imageFiles.forEach(function(i,n){"string"!=typeof i&&(t.append("prefix","createCourseCover"),t.append("file",i),e.$api.fetchPost(t).then(function(t){1==t.code?e.images[n]=t.data.url:e.images[n]="",s==++a&&e.submitForm()}))})},submitForm:function(){var e=this;this.btnText="正在提交...",this.id?this.$api.updateCase({id:this.id,title:this.title,content:this.message,images:this.images.join(",")}).then(function(e){t(e,"修改成功",0)}):this.$api.createCase({title:this.title,content:this.message,images:this.images.join(",")}).then(function(e){t(e,"提交成功",1)});var t=function(t,i,s){e.pushing=!1,t.code==s?(e.$popup(i),e.title="",e.message="",e.images=[],e.imageFiles=[],e.imageSrc=[],e.btnText="发布",setTimeout(function(){e.$router.go(-1)},1e3)):e.$popup(t.msg)}}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"j-form"},[s("div",{staticClass:"j-form-content"},[s("div",{staticClass:"j-form-title"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.title,expression:"title"}],attrs:{type:"text",name:"title",placeholder:"请输入标题"},domProps:{value:e.title},on:{input:function(t){t.target.composing||(e.title=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"j-form-textarea"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],attrs:{placeholder:"请输入正文"},domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"j-form-images"},[s("ul",{staticClass:"images-list"},[e._l(e.imageSrc,function(t,i){return s("li",{key:i,staticClass:"view"},[s("div",[s("img",{attrs:{src:t}})]),e._v(" "),s("i",{on:{click:function(t){return e.removeImage(i)}}})])}),e._v(" "),s("li",{on:{click:e.openFileSelect}},[s("img",{attrs:{src:i("3WYo")}}),e._v(" "),s("input",{attrs:{id:"files",type:"file",name:"files",multiple:"multiple"},on:{change:e.fileChange}})])],2)])]),e._v(" "),s("div",{class:["j-form-btn",{disabled:e.pushing}],on:{click:e.publick}},[e._v(e._s(e.btnText))])])])},staticRenderFns:[]};var l=i("VU/8")(a,n,!1,function(e){i("qTuR")},null,null);t.default=l.exports},qTuR:function(e,t){}});
//# sourceMappingURL=5.a4fceeb19ba50c078ac2.js.map