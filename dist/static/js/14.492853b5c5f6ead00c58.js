webpackJsonp([14],{KIo0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("XTnM");var n=i("2Uyi"),s={data:function(){return{baseUrl:n.a.ossUrl,mode:this.$route.query.mode||"level",matching:!0,rival:{},rule:{},batch_id:0,myScore:0,rivalScore:0,score:0,consuming:0,consumingText:"00:00",max_duration:20,userInfo:this.$store.state.userInfo,beginTime:"",endTime:"",cacheData:{},beginData:[],gameStatus:"matching",timingLeftStyle:"",timingRightStyle:"",isRotate:!1,timingCount:10,countdownTimer:null,currentQuestion:{},questionIndex:0,isCorrect:"",answerList:[],isCanDoAnswer:!0,isPkWin:!1,audioSrc:!1,rivalAnswerStatus:"",ruleitem:{},correctCount:0,gameTimer:null,questionTimer:null,audioTimer:null,isIOS:!1}},created:function(){this.init();var t=navigator.userAgent;this.isIOS=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},methods:{init:function(){this.matching=!0,this.gameStatus="matching",this.isCanDoAnswer=!0,this.beginData=[],this.questionIndex=0,this.timingLeftStyle="",this.timingRightStyle="",this.consuming=0,this.countdownTimer=null,this.gameTimer=null,this.questionTimer=null,this.audioTimer=null,this.myScore=0,this.rivalScore=0,this.isCorrect="",this.rivalAnswerStatus="",this.answerBeginByUnlimited()},getQuestion:function(t){var e=this;this.$api.getQuestion({batch_id:t}).then(function(t){1==t.code?(e.beginData=t.data,setTimeout(function(){e.checkIsAudio(0)},2e3)):e.$popup(t.msg)})},getaUnlimitedQuestion:function(t){var e=this;this.$api.getQuestion({batch_id:t,num:5*this.rule.length}).then(function(t){1==t.code?(e.beginData=t.data,e.checkIsAudio(0)):e.$popup(t.msg)})},answerBeginByUnlimited:function(){var t=this;this.gameStatus="matching",this.$api.answerBegin({mode:this.mode}).then(function(e){1==e.code?(t.batch_id=e.data.batch_id,t.rule=e.data.rule,t.getaUnlimitedQuestion(e.data.batch_id)):t.$popup(e.msg)})},pkModeBegin:function(t){var e=this;if(t>=this.beginData.length)this.pkModeEnd();else{this.timingRightStyle="",this.timingLeftStyle="",this.isCanDoAnswer=!0,this.gameStatus="prepare",this.questionIndex=t,this.currentQuestion=this.beginData[this.questionIndex],this.isCorrect="",this.rivalAnswerStatus="",this.answerList=this.currentQuestion.options_list.map(function(t){return 0});var i=this.currentQuestion.correct_list;this.currentQuestion.correct_list=this.currentQuestion.options_list.map(function(t,e){return i.indexOf(e)>-1}),this.questionTimer=setTimeout(function(){e.gameStatus="start",e.checkIsAudio(e.questionIndex+1),e.beginTime=(new Date).getTime();var t=Math.floor(e.questionIndex/5);if(e.ruleitem=e.rule[t],e.currentQuestion.audio){var i=document.getElementById("qa-audio");i.play(),i.pause(),i.currentTime=0;var n=function(){e.currentQuestion.duration=i.duration};e.audioTimer=setTimeout(function(){e.$wx.ready(function(){i.play(),i.removeEventListener("loadedmetadata",n,!1)})},500),i.addEventListener("loadedmetadata",n,!1)}e.timingCountDown(e.ruleitem.max_duration)},1500)}},playAudio:function(){this.isIOS&&document.getElementById("qa-audio").play()},stopAudio:function(){document.getElementById("qa-audio").pause(),audi0.currentTime=0},pkModeEnd:function(){var t=this;console.log("game over"),this.$api.answerEnd({batch_id:this.batch_id}).then(function(e){t.gameStatus="end",t.isPkWin=t.myScore>t.rivalScore,1==e.code?t.score=e.data.score:t.$popup(e.msg)})},checkIsAudio:function(t){var e=this;if(!(t>=this.beginData.length)){var i=this.beginData[t];if(i.audio&&i.audio.length){if(0==t){for(var n=0;n<this.beginData.length;n++)if(!this.beginData[n].audio){this.beginData[0]=this.beginData[n],this.beginData[n]=i;break}return void this.pkModeBegin(t)}this.$nextTick(function(){var t=document.getElementById("qa-audio");t&&(i.audio.forEach(function(i){var n=document.createElement("source"),s=i.split(".")[1];n.type="ogg"==s?"audio/ogg":"audio/mpeg",n.src=e.baseUrl+i,t.appendChild(n)}),t.load())})}else 0==t&&this.pkModeBegin(t)}},doAnswer:function(t){if(this.isCanDoAnswer){var e=this.answerList.some(function(t){return t});if("single"==this.currentQuestion.question_type)e||(this.answerList[t]=1,this.endTime=(new Date).getTime(),this.checkAnswer());else this.answerList[t]=!this.answerList[t],this.answerList.filter(function(t){return t}).length==this.currentQuestion.correct_list.filter(function(t){return t}).length&&(this.endTime=(new Date).getTime(),this.checkAnswer());this.$forceUpdate()}},timingCountDown:function(t){var e=this;this.timingCount=t;var i=5*Number(t),n=0;this.countdownTimer=setInterval(function(){++n%10==0&&e.timingCount--,n<=i?e.timingRightStyle="transform: rotate("+(180/i*n-45)+"deg)":e.timingLeftStyle="transform: rotate("+(180/i*(n-i)-45)+"deg)",e.timingCount<=0&&(clearInterval(e.countdownTimer),e.countdownTimer=null,e.isRotate=!1,e.checkAnswer())},100)},checkAnswer:function(){var t=this;this.isCanDoAnswer=!1,this.gameStatus="checking";var e=this.checkISCorrect();this.isCorrect=e?"success":"fail",this.myScore+=e?this.ruleitem.level_score:0,this.correctCount+=e?1:0,clearInterval(this.countdownTimer),this.countdownTimer=null,this.isRotate=!1,this.questionReply(),this.questionIndex%5==4?setTimeout(function(){t.gameStatus="end",t.isPkWin=t.correctCount>=3;var e=Math.ceil(t.questionIndex/5),i=t.rule[e];t.score=t.correctCount*i.level_score},2e3):this.gameTimer=setTimeout(function(){t.pkModeBegin(t.questionIndex+1)},2e3)},nextLevel:function(){this.correctCount=0,this.pkModeBegin(this.questionIndex+1)},checkISCorrect:function(){var t=this,e=this.answerList.filter(function(t){return t}).length,i=this.currentQuestion.correct_list.filter(function(t){return t}).length,n=this.currentQuestion.correct_list.every(function(e,i){return!!e==!!t.answerList[i]});return e==i&&n},questionReply:function(){var t=((this.endTime||(new Date).getTime())-this.beginTime)/1e3,e=this.answerList.map(function(t,e){return t?String(e):""}).filter(function(t){return t}),i={batch_id:this.batch_id,question_id:this.currentQuestion.id,selecteds:e,duration:t};e.length||(i.selecteds[0]=""),this.$api.questionReply(i).then(function(t){})},oneMoreTry:function(){this.init()},goBack:function(){this.$router.go(-1)}},beforeDestroy:function(){clearInterval(this.countdownTimer),this.countdownTimer=null,clearInterval(this.gameTimer),this.gameTimer=null,clearInterval(this.questionTimer),this.questionTimer=null,clearInterval(this.audioTimer),this.audioTimer=null},watch:{consuming:function(t){var e=t-t%60,i=t-60*e;e=e<10?"0"+e:e,i=i<10?"0"+i:i,this.consumingText=e+":"+i}},filters:{duration2str:function(t){var e=(t=Math.ceil(t||0))-t%60,i=t-60*e;return(e=e<10?"0"+e:e)+":"+(i=i<10?"0"+i:i)}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"game-wrap"},["matching"!==t.gameStatus&&"end"!==t.gameStatus?i("div",{staticClass:"game-container"},[i("div",{staticClass:"game-player"},[i("div",{staticClass:"game-player-self"},[i("div",{staticClass:"game-player-score"},[t._v(t._s(t.myScore))]),t._v(" "),i("div",{class:["game-player-avatar",{success:"success"==t.isCorrect},{fail:"fail"==t.isCorrect}]},[i("img",{attrs:{src:t.userInfo.avatar}})])]),t._v(" "),"start"!=t.gameStatus&&"checking"!=t.gameStatus||"unlimited"===t.mode?t._e():i("div",{staticClass:"game-timing"},[i("div",{staticClass:"game-timing-left"},[i("i",{class:{rotate:t.isRotate},style:t.timingLeftStyle})]),t._v(" "),i("div",{staticClass:"game-timing-right"},[i("i",{class:{rotate:t.isRotate},style:t.timingRightStyle})]),t._v(" "),i("span",[t._v(t._s(t.timingCount))])])]),t._v(" "),"prepare"==t.gameStatus?i("div",{class:["game-question-type",t.currentQuestion.question_type]},[i("label",[t._v("第"+t._s(t.questionIndex+1)+"题")]),t._v(" "),i("div",{staticClass:"q-type"},[t._v(t._s("single"==t.currentQuestion.question_type?"单选题":"多选题"))])]):t._e(),t._v(" "),t._m(0),t._v(" "),"start"==t.gameStatus||"checking"==t.gameStatus?i("div",{staticClass:"game-qa"},[i("div",{staticClass:"game-question"},[t._v("\n                "+t._s(t.currentQuestion.title)+"\n                "),t.currentQuestion.image?i("img",{attrs:{src:t.currentQuestion.image}}):t._e(),t._v(" "),t.currentQuestion.audio?i("div",{staticClass:"game-q-audio",on:{click:t.playAudio}},[t._v("\n                    "+t._s(t._f("duration2str")(t.currentQuestion.duration))),i("span",[t._v(t._s(t.isIOS?"  点击播放":""))])]):t._e()]),t._v(" "),i("ul",{staticClass:"game-answer-list"},t._l(t.currentQuestion.options_list,function(e,n){return i("li",{key:n,class:{choose:1==t.answerList[n],correct:t.currentQuestion.correct_list[n]&&"checking"==t.gameStatus,success:t.currentQuestion.correct_list[n]&&1==t.answerList[n]&&"checking"==t.gameStatus,fail:!t.currentQuestion.correct_list[n]&&1==t.answerList[n]&&"checking"==t.gameStatus},on:{click:function(e){return t.doAnswer(n)}}},[t._v(t._s(e))])}),0),t._v(" "),"checking"==t.gameStatus?i("div",{class:["game-answer-result",t.isCorrect?t.isCorrect:""]},["fail"==t.isCorrect?i("span",[t._v("很遗憾，回答错误")]):t._e(),t._v(" "),"success"==t.isCorrect?i("span",[t._v("恭喜您，回答正确")]):t._e()]):t._e()]):t._e()]):t._e(),t._v(" "),"end"==t.gameStatus?i("div",{class:["layer-pk-mode","layer-pk-mode-level",t.isPkWin?"success":"fail"]},[i("div",{staticClass:"gameover-result-title"},[t._v(t._s(t.isPkWin?"闯关成功":"闯关失败"))]),t._v(" "),i("div",{staticClass:"gameover-result-content"},[t._m(1),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"game-score-count"},[t._v("积分+"+t._s(t.score))]),t._v(" "),i("div",{staticClass:"gameover-btns"},[i("a",{staticClass:"goback",on:{click:t.goBack}},[t._v("返回")]),t._v(" "),"end"==t.gameStatus&&(t.questionIndex==t.beginData.length-1||t.questionIndex<t.beginData.length-1&&!t.isPkWin)?i("a",{staticClass:"try-again",on:{click:function(e){return t.oneMoreTry()}}},[t._v("再来一局")]):t._e(),t._v(" "),"end"==t.gameStatus&&t.questionIndex<t.beginData.length-1&&t.isPkWin?i("a",{staticClass:"try-again",on:{click:function(e){return t.nextLevel()}}},[t._v("下一关")]):t._e()])])]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{display:"none"}},[e("audio",{attrs:{id:"qa-audio",preload:"preload"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{overflow:"hidden"}},[e("div",{staticClass:"myself"},[e("div",{staticClass:"avatar"})])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{staticClass:"game-this-round"},[e("em",[this._v("本局奖励")])])}]};var r=i("VU/8")(s,a,!1,function(t){i("Vhns")},null,null);e.default=r.exports},Vhns:function(t,e){}});
//# sourceMappingURL=14.492853b5c5f6ead00c58.js.map