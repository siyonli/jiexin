webpackJsonp([14],{"085P":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});e("XTnM");var s=e("2Uyi"),n={data:function(){return{baseUrl:s.a.ossUrl,mode:this.$route.query.mode||"pk",matching:!0,rival:{user_id:"2",nickname:"Luca",avatar:"/uploads/20190801/41c366155ef4324020251f0def4de6c2.jpeg"},rule:{},batch_id:0,myScore:0,rivalScore:0,score:0,consuming:0,consumingText:"00:00",max_duration:20,userInfo:this.$store.state.userInfo,beginTime:"",endTime:"",beginData:{},gameStatus:"matching",timingLeftStyle:"",timingRightStyle:"",isRotate:!1,timingCount:10,countdownTimer:null,currentQuestion:{},questionIndex:0,isCorrect:"",answerList:[],isCanDoAnswer:!0,isPkWin:!1,audioSrc:!1,rivalAnswerStatus:"",gameTimer:null,questionTimer:null,rivalTimer:null,audioTimer:null,consumingTimer:null,beginTimer:null,checkAudioTimer:null,isIOS:!1}},created:function(){this.init();var t=navigator.userAgent;this.isIOS=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},methods:{init:function(){this.matching=!0,this.gameStatus="matching",this.isCanDoAnswer=!0,this.beginData=[],this.questionIndex=0,this.timingLeftStyle="",this.timingRightStyle="",this.consuming=0,this.countdownTimer=null,this.consumingTimer=null,this.gameTimer=null,this.questionTimer=null,this.rivalTimer=null,this.audioTimer=null,this.beginTimer=null,this.checkAudioTimer=null,this.myScore=0,this.rivalScore=0,this.isCorrect="",this.rivalAnswerStatus="","pk"==this.mode&&this.answerBeginByPK(),"unlimited"==this.mode&&this.answerBeginByUnlimited()},answerBeginByPK:function(){var t=this,i=function(i){t.rival=i.rival,t.rule=i.rule,t.batch_id=i.batch_id,t.getQuestion(i.batch_id),clearInterval(t.consumingTimer),t.consumingTimer=null};this.consumingTimer=setInterval(function(){t.consuming++},1e3);var e=(new Date).getTime();this.$api.answerBegin({mode:this.mode}).then(function(s){if(1==s.code){var n=(new Date).getTime();n-e>=4e3?(t.matching=!1,i(s.data)):t.beginTimer=setTimeout(function(){t.matching=!1,i(s.data)},4e3-n+e)}})},getQuestion:function(t){var i=this;this.$api.getQuestion({batch_id:t}).then(function(t){1==t.code?(i.beginData=t.data,i.checkAudioTimer=setTimeout(function(){i.checkIsAudio(0)},2e3)):i.$popup(t.msg)})},getaUnlimitedQuestion:function(t){var i=this;this.$api.getQuestion({batch_id:t}).then(function(t){1==t.code?(i.beginData=t.data,i.checkIsAudio(0)):i.$popup(t.msg)})},answerBeginByUnlimited:function(){var t=this;this.gameStatus="matching",this.$api.answerBegin({mode:this.mode}).then(function(i){1==i.code?(t.batch_id=i.data.batch_id,t.rule=i.data.rule,t.getaUnlimitedQuestion(i.data.batch_id)):t.$popup(i.msg)})},pkModeBegin:function(t){var i=this;if(t>=this.beginData.length)this.pkModeEnd();else{this.timingRightStyle="",this.timingLeftStyle="",this.isCanDoAnswer=!0,this.gameStatus="prepare",this.questionIndex=t,this.currentQuestion=this.beginData[this.questionIndex],this.isCorrect="",this.rivalAnswerStatus="",this.answerList=this.currentQuestion.options_list.map(function(t){return 0});var e=this.currentQuestion.correct_list;this.currentQuestion.correct_list=this.currentQuestion.options_list.map(function(t,i){return e.indexOf(i)>-1}),this.questionTimer=setTimeout(function(){i.checkIsAudio(i.questionIndex+1);var t=i.currentQuestion.max_duration||i.max_duration;if(i.currentQuestion.audio){var e=document.getElementById("qa-audio");if(e.load(),e.play(),e.pause(),e.currentTime=0,i.isIOS)t+=4,i.gameStatus="start",i.timingCountDown(t);else{var s=function(){i.currentQuestion.duration=e.duration,t+=Math.ceil(e.duration)+2,i.gameStatus="start",i.timingCountDown(t),i.beginTime=(new Date).getTime()};i.audioTimer=setTimeout(function(){i.$wx.ready(function(){e.play(),e.removeEventListener("loadedmetadata",s,!0)})},500),e.addEventListener("loadedmetadata",s,!0)}}else i.gameStatus="start",i.beginTime=(new Date).getTime(),i.timingCountDown(t);i.rivalTimer=setTimeout(function(){i.rivalAnswerStatus=1==i.currentQuestion.rival_correct?"success":"fail",i.isBothAnswer("对手答题完毕")},1e3*i.currentQuestion.rival_duration)},1500)}},playAudio:function(){this.isIOS&&document.getElementById("qa-audio").play()},stopAudio:function(){document.getElementById("qa-audio").pause(),audi0.currentTime=0},pkModeEnd:function(){var t=this;console.log("game over"),this.$api.answerEnd({batch_id:this.batch_id}).then(function(i){t.gameStatus="end",t.isPkWin=i.data.score>0,1==i.code?t.score=i.data.score:t.$popup(i.msg)})},checkIsAudio:function(t){var i=this;if(!(t>=this.beginData.length)){var e=this.beginData[t];if(e.audio&&e.audio.length){if(0==t){for(var s=0;s<this.beginData.length;s++)if(!this.beginData[s].audio){this.beginData[0]=this.beginData[s],this.beginData[s]=e;break}return void this.pkModeBegin(t)}this.$nextTick(function(){var t=document.getElementById("qa-audio");t&&(e.audio.forEach(function(e){var s=document.createElement("source"),n=e.split(".")[1];s.type="ogg"==n?"audio/ogg":"audio/mpeg",s.src=i.baseUrl+e,t.appendChild(s)}),t.load())})}else 0==t&&"pk"==this.mode&&this.pkModeBegin(t)}},doAnswer:function(t){if(this.isCanDoAnswer){var i=this.answerList.some(function(t){return t});if("single"==this.currentQuestion.question_type){if(!i){this.answerList[t]=1,this.endTime=(new Date).getTime();i=this.checkISCorrect();this.isCorrect=i?"success":"fail",this.isBothAnswer("单选题，本人答题完毕")}}else if(this.answerList[t]=!this.answerList[t],this.answerList.filter(function(t){return t}).length==this.currentQuestion.correct_list.filter(function(t){return t}).length){this.endTime=(new Date).getTime();i=this.checkISCorrect();this.isCorrect=i?"success":"fail",this.isBothAnswer("多选题，本人答题完毕")}this.$forceUpdate()}},isBothAnswer:function(t){var i=this;console.log(t,this.isCorrect,this.rivalAnswerStatus,this.myScore),this.stopAudio(),this.isCorrect&&this.rivalAnswerStatus?(clearInterval(this.countdownTimer),this.countdownTimer=null,this.isRotate=!1,this.isCanDoAnswer=!1,this.gameStatus="checking",this.myScore+="success"==this.isCorrect?this.rule.win_score:0,this.rivalScore+=1==this.currentQuestion.rival_correct?this.rule.win_score:0,this.questionReply(),this.gameTimer=setTimeout(function(){i.pkModeBegin(i.questionIndex+1)},2e3)):this.isCorrect&&(this.gameStatus="checking")},timingCountDown:function(t){var i=this;this.timingCount=t;var e=5*Number(t),s=0;this.countdownTimer=setInterval(function(){++s%10==0&&i.timingCount--,s<=e?i.timingRightStyle="transform: rotate("+(180/e*s-45)+"deg)":i.timingLeftStyle="transform: rotate("+(180/e*(s-e)-45)+"deg)",i.timingCount<=0&&(clearInterval(i.countdownTimer),i.countdownTimer=null,i.isRotate=!1,i.checkAnswer())},100)},checkAnswer:function(){var t=this;this.isCanDoAnswer=!1,this.gameStatus="checking";var i=this.checkISCorrect();this.isCorrect=i?"success":"fail",this.myScore+=i?this.rule.win_score:0,this.rivalScore+=1==this.currentQuestion.rival_correct?this.rule.win_score:0,console.log("检查答案"),this.questionReply(),setTimeout(function(){t.pkModeBegin(t.questionIndex+1)},2e3)},checkISCorrect:function(){var t=this,i=this.answerList.filter(function(t){return t}).length,e=this.currentQuestion.correct_list.filter(function(t){return t}).length,s=this.currentQuestion.correct_list.every(function(i,e){return!!i==!!t.answerList[e]});return i==e&&s},questionReply:function(){var t=((this.endTime||(new Date).getTime())-this.beginTime)/1e3,i=this.answerList.map(function(t,i){return t?String(i):""}).filter(function(t){return t}),e={batch_id:this.batch_id,question_id:this.currentQuestion.id,selecteds:i,duration:t};i.length||(e.selecteds[0]=""),this.$api.questionReply(e).then(function(t){})},oneMoreTry:function(){this.init()},goBack:function(){window.history.go(-1)}},beforeDestroy:function(){console.log("页面组件即将销毁"),clearInterval(this.countdownTimer),this.countdownTimer=null,clearInterval(this.gameTimer),this.gameTimer=null,clearInterval(this.questionTimer),this.questionTimer=null,clearInterval(this.rivalTimer),this.rivalTimer=null,clearInterval(this.audioTimer),this.audioTimer=null,clearInterval(this.consumingTimer),this.consumingTimer=null,clearInterval(this.beginTimer),this.beginTimer=null,clearInterval(this.checkAudioTimer),this.checkAudioTimer=null},watch:{consuming:function(t){var i=t-t%60,e=t-60*i;i=i<10?"0"+i:i,e=e<10?"0"+e:e,this.consumingText=i+":"+e}},filters:{duration2str:function(t){console.log(t);var i=(t=Math.ceil(t||0))-t%60,e=t-60*i;return(i=i<10?"0"+i:i)+":"+(e=e<10?"0"+e:e)}}},a={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"game-wrap"},["pk"==t.mode&&"matching"==t.gameStatus?e("div",{staticClass:"matching"},[e("div",{staticClass:"matching-animate"},[e("div",{staticClass:"user"},[e("img",{attrs:{src:t.userInfo.avatar}})]),t._v(" "),e("div",{staticClass:"matching-planet matching-planet-1"}),t._v(" "),e("div",{staticClass:"matching-planet matching-planet-2"}),t._v(" "),e("div",{staticClass:"matching-planet matching-planet-3"}),t._v(" "),t.matching?t._e():e("div",{staticClass:"rival"},[e("img",{attrs:{src:t.rival.avatar}})])]),t._v(" "),t.matching?e("div",{staticClass:"matching-consuming"},[t._v("正在匹配 "+t._s(t.consumingText))]):e("div",{staticClass:"matching-consuming"},[t._v("匹配完成")]),t._v(" "),t.matching?e("div",{staticClass:"matching-btn matching-btn-cancel",on:{click:t.goBack}},[t._v("取消")]):e("div",{staticClass:"matching-btn matching-btn-done"},[t._v("正在进入")])]):t._e(),t._v(" "),"matching"!==t.gameStatus&&"end"!==t.gameStatus?e("div",{staticClass:"game-container"},[e("div",{staticClass:"game-player"},[e("div",{staticClass:"game-player-self"},[e("div",{staticClass:"game-player-score"},[t._v(t._s(t.myScore))]),t._v(" "),e("div",{class:["game-player-avatar",{success:"success"==t.isCorrect},{fail:"fail"==t.isCorrect}]},[e("img",{attrs:{src:t.userInfo.avatar}})])]),t._v(" "),"pk"==t.mode?e("div",{staticClass:"game-player-rival"},[e("div",{class:["game-player-avatar",t.rivalAnswerStatus]},[e("img",{attrs:{src:t.rival.avatar}})]),t._v(" "),e("div",{staticClass:"game-player-score"},[t._v(t._s(t.rivalScore))])]):t._e(),t._v(" "),"start"!=t.gameStatus&&"checking"!=t.gameStatus||"unlimited"===t.mode?t._e():e("div",{staticClass:"game-timing"},[e("div",{staticClass:"game-timing-left"},[e("i",{class:{rotate:t.isRotate},style:t.timingLeftStyle})]),t._v(" "),e("div",{staticClass:"game-timing-right"},[e("i",{class:{rotate:t.isRotate},style:t.timingRightStyle})]),t._v(" "),e("span",[t._v(t._s(t.timingCount))])])]),t._v(" "),"prepare"==t.gameStatus?e("div",{class:["game-question-type",t.currentQuestion.question_type]},[e("label",[t._v("第"+t._s(t.questionIndex+1)+"题")]),t._v(" "),e("div",{staticClass:"q-type"},[t._v(t._s("single"==t.currentQuestion.question_type?"单选题":"多选题"))])]):t._e(),t._v(" "),t._m(0),t._v(" "),"start"==t.gameStatus||"checking"==t.gameStatus?e("div",{staticClass:"game-qa"},[e("div",{staticClass:"game-question"},[t._v("\n                "+t._s(t.currentQuestion.title)+"\n                "),t.currentQuestion.image?e("img",{attrs:{src:t.currentQuestion.image}}):t._e(),t._v(" "),t.currentQuestion.audio?e("div",{staticClass:"game-q-audio",on:{click:t.playAudio}},[t._v("\n                    "+t._s(t._f("duration2str")(t.currentQuestion.duration))),e("span",[t._v(t._s(t.isIOS?"  点击播放":""))])]):t._e()]),t._v(" "),e("ul",{staticClass:"game-answer-list"},t._l(t.currentQuestion.options_list,function(i,s){return e("li",{key:s,class:{choose:1==t.answerList[s],correct:t.currentQuestion.correct_list[s]&&"checking"==t.gameStatus,success:t.currentQuestion.correct_list[s]&&1==t.answerList[s]&&"checking"==t.gameStatus,fail:!t.currentQuestion.correct_list[s]&&1==t.answerList[s]&&"checking"==t.gameStatus},on:{click:function(i){return t.doAnswer(s)}}},[t._v(t._s(i))])}),0),t._v(" "),"checking"==t.gameStatus?e("div",{class:["game-answer-result",t.isCorrect?t.isCorrect:""]},["fail"==t.isCorrect?e("span",[t._v("很遗憾，回答错误")]):t._e(),t._v(" "),"success"==t.isCorrect?e("span",[t._v("恭喜您，回答正确")]):t._e()]):t._e()]):t._e()]):t._e(),t._v(" "),"pk"==t.mode&&"end"==t.gameStatus?e("div",{class:["layer-pk-mode",t.isPkWin?"success":"fail"]},[e("div",{staticClass:"gameover-result-title"},[t._v(t._s(t.isPkWin?"胜利":"失败"))]),t._v(" "),e("div",{staticClass:"gameover-result-content"},[e("div",{staticStyle:{overflow:"hidden"}},[e("div",{staticClass:"myself"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.userInfo.avatar}})]),t._v(" "),e("div",{staticClass:"score"},[t._v(t._s(t.myScore))])]),t._v(" "),e("div",{staticClass:"rival"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.rival.avatar}})]),t._v(" "),e("div",{staticClass:"score"},[t._v(t._s(t.rivalScore))])])]),t._v(" "),t._m(1),t._v(" "),e("div",{staticClass:"game-score-count"},[t._v("积分+"+t._s(t.score))]),t._v(" "),e("div",{staticClass:"gameover-btns"},[e("a",{staticClass:"goback",on:{click:t.goBack}},[t._v("返回")]),t._v(" "),e("a",{staticClass:"try-again",on:{click:function(i){return t.oneMoreTry()}}},[t._v("再来一局")])])])]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticStyle:{display:"none"}},[i("audio",{attrs:{id:"qa-audio",preload:"preload"}})])},function(){var t=this.$createElement,i=this._self._c||t;return i("label",{staticClass:"game-this-round"},[i("em",[this._v("本局奖励")])])}]};var r=e("VU/8")(n,a,!1,function(t){e("66yo")},null,null);i.default=r.exports},"66yo":function(t,i){}});
//# sourceMappingURL=14.9a972098ee8aa282c5c8.js.map