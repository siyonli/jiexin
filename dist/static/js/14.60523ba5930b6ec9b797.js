webpackJsonp([14],{"5YdR":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("XTnM");var s=i("2Uyi"),n={data:function(){return{baseUrl:s.a.ossUrl,mode:this.$route.query.mode||"unlimited",matching:!0,rival:{},rule:{},batch_id:0,myScore:0,rivalScore:0,score:0,consuming:0,consumingText:"00:00",max_duration:20,userInfo:this.$store.state.userInfo,beginTime:"",endTime:"",cacheData:{},beginData:{},gameStatus:"matching",timingLeftStyle:"",timingRightStyle:"",isRotate:!1,timingCount:10,countdownTimer:null,currentQuestion:{},questionIndex:0,isCorrect:"",answerList:[],isCanDoAnswer:!0,isPkWin:!1,audioSrc:!1,rivalAnswerStatus:"",wrongCount:0,nextTimer:null,gameTimer:null,audioTimer:null}},created:function(){this.init()},beforeDestroy:function(){clearTimeout(this.nextTimer),this.nextTimer=null,clearTimeout(this.gameTimer),this.gameTimer=null,clearTimeout(this.audioTimer),this.audioTimer=null},methods:{init:function(){this.matching=!0,this.gameStatus="matching",this.isCanDoAnswer=!0,this.beginData=[],this.questionIndex=0,this.timingLeftStyle="",this.timingRightStyle="",this.consuming=0,this.countdownTimer=null,this.nextTimer=null,this.gameTimer=null,this.audioTimer=null,this.myScore=0,this.rivalScore=0,this.isCorrect="",this.rivalAnswerStatus="",this.wrongCount=0,this.answerBeginByUnlimited()},getQuestion:function(t){var e=this;this.$api.getQuestion({batch_id:t}).then(function(t){1==t.code?(e.beginData=t.data,setTimeout(function(){e.checkIsAudio(0)},2e3)):e.$popup(t.msg)})},getUnlimitedQuestion:function(t){var e=this;this.$api.getQuestion({batch_id:t}).then(function(t){1==t.code?(e.beginData=t.data,e.checkIsAudio(0)):e.$popup(t.msg)})},answerBeginByUnlimited:function(){var t=this;this.gameStatus="matching",this.$api.answerBegin({mode:this.mode}).then(function(e){1==e.code?(t.batch_id=e.data.batch_id,t.rule=e.data.rule,t.getUnlimitedQuestion(e.data.batch_id)):t.$popup(e.msg)})},unlimitedModeBegin:function(t){if(t>=this.beginData.length)this.pkModeEnd();else{this.isCanDoAnswer=!0,this.gameStatus="prepare",this.questionIndex=t,this.currentQuestion=this.beginData[this.questionIndex],this.isCorrect="",this.rivalAnswerStatus="",this.answerList=this.currentQuestion.options_list.map(function(t){return 0});var e=this.currentQuestion.correct_list;this.currentQuestion.correct_list=this.currentQuestion.options_list.map(function(t,i){return e.indexOf(i)>-1});var i=this;this.gameTimer=setTimeout(function(){if(i.gameStatus="start",i.checkIsAudio(i.questionIndex+1),i.beginTime=(new Date).getTime(),i.currentQuestion.audio){var t=document.getElementById("qa-audio");t.play(),t.pause(),t.currentTime=0,i.audioTimer=setTimeout(function(){i.$wx.ready(function(){t.play(),t.removeEventListener("loadedmetadata",fn,!1)})},500),t.addEventListener("loadedmetadata",fn,!1)}},1500)}},playAudio:function(){this.isIOS&&document.getElementById("qa-audio").play()},stopAudio:function(){document.getElementById("qa-audio").pause(),audi0.currentTime=0},pkModeEnd:function(){var t=this;console.log("game over"),this.$api.answerEnd({batch_id:this.batch_id}).then(function(e){t.gameStatus="end",t.isPkWin=t.wrongCount<4,1==e.code?t.score=e.data.score:t.$popup(e.msg)})},checkIsAudio:function(t){var e=this;if(!(t>=this.beginData.length)){var i=this.beginData[t];if(i.audio){if(0==t){for(var s=0;s<this.beginData.length;s++)if(!this.beginData[s].audio){this.beginData[0]=this.beginData[s],this.beginData[s]=i;break}return void this.pkModeBegin(t)}this.$nextTick(function(){var t=document.getElementById("qa-audio");t&&(i.audio.forEach(function(i){var s=document.createElement("source"),n=i.split(".")[1];s.type="ogg"==n?"audio/ogg":"audio/mpeg",s.src=e.baseUrl+i,t.appendChild(s)}),t.load())})}else 0==t&&"pk"==this.mode&&this.pkModeBegin(t),0==t&&"unlimited"==this.mode&&this.unlimitedModeBegin(t)}},doAnswer:function(t){if(this.isCanDoAnswer){var e=this.answerList.some(function(t){return t});if("single"==this.currentQuestion.question_type){if(!e){this.answerList[t]=1,this.endTime=(new Date).getTime();e=this.checkISCorrect();this.isCorrect=e?"success":"fail",this.checkAnswer()}}else this.answerList[t]=!this.answerList[t],this.answerList.filter(function(t){return t}).length==this.currentQuestion.correct_list.filter(function(t){return t}).length&&(this.endTime=(new Date).getTime(),this.checkAnswer());this.$forceUpdate()}},checkAnswer:function(){var t=this;this.isCanDoAnswer=!1,this.gameStatus="checking";var e=this.checkISCorrect();this.isCorrect=e?"success":"fail",this.wrongCount+=e?0:1,this.myScore+=e?this.rule.one_correct_score:0,this.questionReply(),this.nextTimer=setTimeout(function(){t.wrongCount>=3?t.pkModeEnd():t.unlimitedModeBegin(t.questionIndex+1)},2e3)},checkISCorrect:function(){var t=this,e=this.answerList.filter(function(t){return t}).length,i=this.currentQuestion.correct_list.filter(function(t){return t}).length,s=this.currentQuestion.correct_list.every(function(e,i){return!!e==!!t.answerList[i]});return e==i&&s},questionReply:function(){var t=((this.endTime||(new Date).getTime())-this.beginTime)/1e3,e=this.answerList.map(function(t,e){return t?String(e):""}).filter(function(t){return t}),i={batch_id:this.batch_id,question_id:this.currentQuestion.id,selecteds:e,duration:t};e.length||(i.selecteds[0]=""),this.$api.questionReply(i).then(function(t){})},oneMoreTry:function(){this.init()},goBack:function(){window.history.go(-1)}},watch:{consuming:function(t){var e=t-t%60,i=t-60*e;e=e<10?"0"+e:e,i=i<10?"0"+i:i,this.consumingText=e+":"+i}},filters:{duration2str:function(t){var e=(t=Math.ceil(t))-t%60,i=t-60*e;return(e=e<10?"0"+e:e)+":"+(i=i<10?"0"+i:i)}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"game-wrap"},["matching"!==t.gameStatus&&"end"!==t.gameStatus?i("div",{staticClass:"game-container"},[i("div",{staticClass:"game-player"},[i("div",{staticClass:"game-player-self"},[i("div",{staticClass:"game-player-score"},[t._v(t._s(t.myScore))]),t._v(" "),i("div",{class:["game-player-avatar",{success:"success"==t.isCorrect},{fail:"fail"==t.isCorrect}]},[i("img",{attrs:{src:t.userInfo.avatar}})])]),t._v(" "),"start"!=t.gameStatus&&"checking"!=t.gameStatus||"unlimited"===t.mode?t._e():i("div",{staticClass:"game-timing"},[i("div",{staticClass:"game-timing-left"},[i("i",{class:{rotate:t.isRotate},style:t.timingLeftStyle})]),t._v(" "),i("div",{staticClass:"game-timing-right"},[i("i",{class:{rotate:t.isRotate},style:t.timingRightStyle})]),t._v(" "),i("span",[t._v(t._s(t.timingCount))])]),t._v(" "),i("div",{staticClass:"game-remaining"},[i("i",{class:{grey:t.wrongCount>0}}),t._v(" "),i("i",{class:{grey:t.wrongCount>1}}),t._v(" "),i("i",{class:{grey:t.wrongCount>2}})])]),t._v(" "),"prepare"==t.gameStatus?i("div",{class:["game-question-type",t.currentQuestion.question_type]},[i("label",[t._v("第"+t._s(t.questionIndex+1)+"题")]),t._v(" "),i("div",{staticClass:"q-type"},[t._v(t._s("single"==t.currentQuestion.question_type?"单选题":"多选题"))])]):t._e(),t._v(" "),i("div",{staticStyle:{display:"none"}},[i("audio",{attrs:{id:"qa-audio",src:t.audioSrc,preload:"preload"}})]),t._v(" "),"start"==t.gameStatus||"checking"==t.gameStatus?i("div",{staticClass:"game-qa"},[i("div",{staticClass:"game-question"},[t._v("\n                "+t._s(t.currentQuestion.title)+"\n                "),t.currentQuestion.image?i("img",{attrs:{src:t.currentQuestion.image}}):t._e(),t._v(" "),t.currentQuestion.audio?i("div",{staticClass:"game-q-audio",on:{click:t.playAudio}},[t._v("\n                    "+t._s(t._f("duration2str")(t.currentQuestion.duration))),i("span",[t._v(t._s(t.isIOS?"  点击播放":""))])]):t._e()]),t._v(" "),i("ul",{staticClass:"game-answer-list"},t._l(t.currentQuestion.options_list,function(e,s){return i("li",{key:s,class:{choose:1==t.answerList[s],correct:t.currentQuestion.correct_list[s]&&"checking"==t.gameStatus,success:t.currentQuestion.correct_list[s]&&1==t.answerList[s]&&"checking"==t.gameStatus,fail:!t.currentQuestion.correct_list[s]&&1==t.answerList[s]&&"checking"==t.gameStatus},on:{click:function(e){return t.doAnswer(s)}}},[t._v(t._s(e))])}),0),t._v(" "),"checking"==t.gameStatus?i("div",{class:["game-answer-result",t.isCorrect?t.isCorrect:""]},["fail"==t.isCorrect?i("span",[t._v("很遗憾，回答错误")]):t._e(),t._v(" "),"success"==t.isCorrect?i("span",[t._v("恭喜您，回答正确")]):t._e()]):t._e()]):t._e()]):t._e(),t._v(" "),"end"==t.gameStatus?i("div",{class:["layer-pk-mode","layer-pk-mode-unlimited",t.isPkWin?"success":"fail"]},[i("div",{staticClass:"gameover-result-title"},[t._v(t._s(t.isPkWin?"胜利":"失败"))]),t._v(" "),i("div",{staticClass:"gameover-result-content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"game-score-count"},[t._v("积分+"+t._s(t.score))]),t._v(" "),i("div",{staticClass:"gameover-btns"},[i("a",{staticClass:"goback",on:{click:t.goBack}},[t._v("返回")]),t._v(" "),i("a",{staticClass:"try-again",on:{click:function(e){return t.oneMoreTry()}}},[t._v("再来一局")])])])]):t._e()])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{overflow:"hidden"}},[e("div",{staticClass:"myself"},[e("div",{staticClass:"avatar"})])])},function(){var t=this.$createElement,e=this._self._c||t;return e("label",{staticClass:"game-this-round"},[e("em",[this._v("本局奖励")])])}]};var r=i("VU/8")(n,a,!1,function(t){i("kkhD")},null,null);e.default=r.exports},kkhD:function(t,e){}});
//# sourceMappingURL=14.60523ba5930b6ec9b797.js.map